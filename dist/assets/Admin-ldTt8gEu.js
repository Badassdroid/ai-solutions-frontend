import{r as n,i as ve,j as t}from"./index-DKBqM6Xc.js";import{a as ge}from"./index-xsH4HHeE.js";const i=ge.create({baseURL:"http://localhost:5000/api"});i.interceptors.request.use(m=>{const p=localStorage.getItem("token");return p&&(m.headers.Authorization=`Bearer ${p}`),m},m=>Promise.reject(m));const qe=()=>{const[m,p]=n.useState([]),[w,v]=n.useState([]),[g,y]=n.useState([]),[F,O]=n.useState(!0),[B,u]=n.useState(null),[P,z]=n.useState(null),[A,J]=n.useState(""),[E,V]=n.useState(""),[M,W]=n.useState(""),[N,G]=n.useState({key:"timestamp",direction:"desc"}),[f,H]=n.useState({key:"timestamp",direction:"desc"}),[S,K]=n.useState({key:"timestamp",direction:"desc"}),[Q,C]=n.useState(!1),[X,q]=n.useState(!1),[Y,I]=n.useState(!1),[h,b]=n.useState("add"),[c,R]=n.useState({name:"",email:"",phone:"",company:"",country:"",job_title:"",job_details:""}),[x,L]=n.useState({name:"",email:""}),[o,j]=n.useState({name:"",company:"",review:"",rating:5}),T=ve(),d=e=>{z(e),setTimeout(()=>z(null),3e3)};n.useEffect(()=>{if(!localStorage.getItem("token"))return T("/login");(async()=>{var r,s;O(!0);try{const[l,k,D]=await Promise.all([i.get("/inquiries"),i.get("/newsletters"),i.get("/reviews")]);p(l.data),v(k.data),y(D.data),u(null)}catch(l){u(((s=(r=l.response)==null?void 0:r.data)==null?void 0:s.message)||l.message)}finally{O(!1)}})()},[T]);const Z=async()=>{var e,a;try{const r=await i.get("/export",{responseType:"blob"}),s=URL.createObjectURL(new Blob([r.data])),l=document.createElement("a");l.href=s,l.download=`inquiries-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(l),l.click(),l.remove(),d("Inquiries exported successfully")}catch(r){u(((a=(e=r.response)==null?void 0:e.data)==null?void 0:a.message)||r.message)}},ee=()=>{localStorage.removeItem("token"),T("/login")},_=(e,{key:a,direction:r})=>[...e].sort((s,l)=>{const k=a==="timestamp"?new Date(s[a]):s[a],D=a==="timestamp"?new Date(l[a]):l[a];return k<D?r==="asc"?-1:1:k>D?r==="asc"?1:-1:0}),U=(e,a)=>e.key===a?e.direction==="asc"?" ↑":" ↓":null,$=e=>new Date(e).toLocaleString(),te=_(m,N).filter(e=>{if(!A)return!0;const a=A.toLowerCase();return["name","email","company","country"].some(r=>{var s;return(s=e[r])==null?void 0:s.toLowerCase().includes(a)})}),se=e=>{const a=N.key===e&&N.direction==="asc"?"desc":"asc";G({key:e,direction:a})},ae=()=>{R({name:"",email:"",phone:"",company:"",country:"",job_title:"",job_details:""}),b("add"),C(!0)},re=e=>{R({...e}),b("edit"),C(!0)},ne=async e=>{var a,r;e.preventDefault();try{if(h==="add"){const s=await i.post("/inquiries",c);p([...m,{...c,id:s.data.id,timestamp:new Date().toISOString()}]),d("Inquiry added")}else await i.put(`/inquiries/${c.id}`,c),p(m.map(s=>s.id===c.id?{...c,timestamp:s.timestamp}:s)),d("Inquiry updated");C(!1)}catch(s){u(((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.message)||s.message)}},ie=async e=>{var a,r;if(window.confirm("Delete this inquiry?"))try{await i.delete(`/inquiries/${e}`),p(m.filter(s=>s.id!==e)),d("Inquiry deleted")}catch(s){u(((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.message)||s.message)}},le=_(w,f).filter(e=>{if(!E)return!0;const a=E.toLowerCase();return["name","email"].some(r=>{var s;return(s=e[r])==null?void 0:s.toLowerCase().includes(a)})}),oe=e=>{const a=f.key===e&&f.direction==="asc"?"desc":"asc";H({key:e,direction:a})},ce=()=>{L({name:"",email:""}),b("add"),q(!0)},de=e=>{L({...e}),b("edit"),q(!0)},me=async e=>{var a,r;e.preventDefault();try{if(h==="add"){const s=await i.post("/newsletters",x);v([...w,{...x,id:s.data.id,timestamp:new Date().toISOString()}]),d("Subscription added")}else await i.put(`/newsletters/${x.id}`,x),v(w.map(s=>s.id===x.id?{...x,timestamp:s.timestamp}:s)),d("Subscription updated");q(!1)}catch(s){u(((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.message)||s.message)}},ue=async e=>{var a,r;if(window.confirm("Delete this subscription?"))try{await i.delete(`/newsletters/${e}`),v(w.filter(s=>s.id!==e)),d("Subscription deleted")}catch(s){u(((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.message)||s.message)}},he=_(g,S).filter(e=>{if(!M)return!0;const a=M.toLowerCase();return["name","company"].some(r=>{var s;return(s=e[r])==null?void 0:s.toLowerCase().includes(a)})}),xe=e=>{const a=S.key===e&&S.direction==="asc"?"desc":"asc";K({key:e,direction:a})},pe=()=>{j({name:"",company:"",review:"",rating:5}),b("add"),I(!0)},be=e=>{j({...e}),b("edit"),I(!0)},je=async e=>{var a,r;e.preventDefault();try{if(h==="add"){const s=await i.post("/reviews",o);y([...g,{...o,id:s.data.id,timestamp:new Date().toISOString()}]),d("Review added")}else await i.put(`/reviews/${o.id}`,o),y(g.map(s=>s.id===o.id?{...o,timestamp:s.timestamp}:s)),d("Review updated");I(!1)}catch(s){u(((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.message)||s.message)}},we=async e=>{var a,r;if(window.confirm("Delete this review?"))try{await i.delete(`/reviews/${e}`),y(g.filter(s=>s.id!==e)),d("Review deleted")}catch(s){u(((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.message)||s.message)}};return t.jsxs("div",{className:"admin-page",children:[t.jsx("header",{className:"admin-hero",children:t.jsxs("div",{className:"container text-center",children:[t.jsx("h1",{className:"admin-title",children:"Admin Dashboard"}),t.jsxs("div",{className:"mt-2",children:[t.jsx("button",{onClick:Z,className:"form-button bg-green-600 hover:bg-green-700 mr-2",children:"Export Inquiries"}),t.jsx("button",{onClick:ee,className:"form-button bg-red-600 hover:bg-red-700",children:"Logout"})]})]})}),t.jsxs("main",{className:"container admin-content",children:[B&&t.jsx("div",{className:"alert alert-error",children:B}),P&&t.jsx("div",{className:"alert alert-success",children:P}),F?t.jsx("div",{className:"text-center py-10",children:"Loading..."}):t.jsxs(t.Fragment,{children:[t.jsxs("section",{className:"mb-8",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Customer Inquiries"}),t.jsx("button",{onClick:ae,className:"big-button form-button bg-blue-600 hover:bg-blue-700",children:"Add Inquiry"})]}),t.jsx("input",{type:"text",placeholder:"Search…",className:"form-input mb-4",value:A,onChange:e=>J(e.target.value)}),t.jsx("div",{className:"overflow-auto",children:t.jsxs("table",{className:"min-w-full bg-white border",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[["id","name","email","phone","company","country","job_title","timestamp"].map(e=>t.jsxs("th",{onClick:()=>se(e),className:"cursor-pointer",children:[e.replace("_"," ").toUpperCase(),U(N,e)]},e)),t.jsx("th",{children:"ACTIONS"})]})}),t.jsx("tbody",{children:te.map(e=>t.jsxs("tr",{children:[t.jsx("td",{children:e.id}),t.jsx("td",{children:e.name}),t.jsx("td",{children:e.email}),t.jsx("td",{children:e.phone}),t.jsx("td",{children:e.company}),t.jsx("td",{children:e.country}),t.jsx("td",{children:e.job_title}),t.jsx("td",{children:$(e.timestamp)}),t.jsxs("td",{children:[t.jsx("button",{onClick:()=>re(e),className:"btn-small mr-2 text-blue-600 hover:underline",children:"Edit"}),t.jsx("button",{onClick:()=>ie(e.id),className:"btn-small text-red-600 hover:underline",children:"Delete"})]})]},e.id))})]})})]}),t.jsxs("section",{className:"mb-8",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Newsletter Subscriptions"}),t.jsx("button",{onClick:ce,className:"big-button form-button bg-blue-600 hover:bg-blue-700",children:"Add Subscription"})]}),t.jsx("input",{type:"text",placeholder:"Search…",className:"form-input mb-4",value:E,onChange:e=>V(e.target.value)}),t.jsx("div",{className:"overflow-auto",children:t.jsxs("table",{className:"min-w-full bg-white border",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[["name","email","timestamp"].map(e=>t.jsxs("th",{onClick:()=>oe(e),className:"cursor-pointer",children:[e.toUpperCase(),U(f,e)]},e)),t.jsx("th",{children:"ACTIONS"})]})}),t.jsx("tbody",{children:le.map(e=>t.jsxs("tr",{children:[t.jsx("td",{children:e.name}),t.jsx("td",{children:e.email}),t.jsx("td",{children:$(e.timestamp)}),t.jsxs("td",{children:[t.jsx("button",{onClick:()=>de(e),className:"btn-small mr-2 text-blue-600 hover:underline",children:"Edit"}),t.jsx("button",{onClick:()=>ue(e.id),className:"btn-small text-red-600 hover:underline",children:"Delete"})]})]},e.id))})]})})]}),t.jsxs("section",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Client Reviews"}),t.jsx("button",{onClick:pe,className:"big-button form-button bg-blue-600 hover:bg-blue-700",children:"Add Review"})]}),t.jsx("input",{type:"text",placeholder:"Search…",className:"form-input mb-4",value:M,onChange:e=>W(e.target.value)}),t.jsx("div",{className:"overflow-auto",children:t.jsxs("table",{className:"min-w-full bg-white border",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[["name","company","rating","timestamp"].map(e=>t.jsxs("th",{onClick:()=>xe(e),className:"cursor-pointer",children:[e.toUpperCase(),U(S,e)]},e)),t.jsx("th",{children:"REVIEW"}),t.jsx("th",{children:"ACTIONS"})]})}),t.jsx("tbody",{children:he.map(e=>t.jsxs("tr",{children:[t.jsx("td",{children:e.name}),t.jsx("td",{children:e.company}),t.jsx("td",{children:[1,2,3,4,5].map(a=>t.jsx("span",{className:`text-xl ${e.rating>=a?"text-yellow-400":"text-gray-300"}`,children:"★"},a))}),t.jsx("td",{children:$(e.timestamp)}),t.jsx("td",{children:e.review}),t.jsxs("td",{children:[t.jsx("button",{onClick:()=>be(e),className:"btn-small mr-2 text-blue-600 hover:underline",children:"Edit"}),t.jsx("button",{onClick:()=>we(e.id),className:"btn-small text-red-600 hover:underline",children:"Delete"})]})]},e.id))})]})})]})]})]}),Q&&t.jsx("div",{className:"modal-overlay",children:t.jsxs("div",{className:"modal-content",children:[t.jsx("h2",{children:h==="add"?"Add Inquiry":"Edit Inquiry"}),t.jsxs("form",{onSubmit:ne,children:[["name","email","phone","company","country","job_title"].map(e=>t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-gray-700 mb-1",children:e.replace("_"," ").toUpperCase()}),t.jsx("input",{type:e==="email"?"email":e==="phone"?"tel":"text",className:"form-input w-full",value:c[e],onChange:a=>R({...c,[e]:a.target.value}),required:e==="name"||e==="email"})]},e)),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-gray-700 mb-1",children:"Job Details"}),t.jsx("textarea",{className:"form-input w-full",rows:"4",value:c.job_details,onChange:e=>R({...c,job_details:e.target.value}),required:!0})]}),t.jsxs("div",{className:"flex justify-end",children:[t.jsx("button",{type:"button",onClick:()=>C(!1),className:"form-button bg-gray-400 mr-2",children:"Cancel"}),t.jsx("button",{type:"submit",className:"form-button bg-blue-600",children:h==="add"?"Add":"Save"})]})]})]})}),X&&t.jsx("div",{className:"modal-overlay",children:t.jsxs("div",{className:"modal-content",children:[t.jsx("h2",{children:h==="add"?"Add Subscription":"Edit Subscription"}),t.jsxs("form",{onSubmit:me,children:[["name","email"].map(e=>t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-gray-700 mb-1",children:e.toUpperCase()}),t.jsx("input",{type:e==="email"?"email":"text",className:"form-input w-full",value:x[e],onChange:a=>L({...x,[e]:a.target.value}),required:!0})]},e)),t.jsxs("div",{className:"flex justify-end",children:[t.jsx("button",{type:"button",onClick:()=>q(!1),className:"form-button bg-gray-400 mr-2",children:"Cancel"}),t.jsx("button",{type:"submit",className:"form-button bg-blue-600",children:h==="add"?"Add":"Save"})]})]})]})}),Y&&t.jsx("div",{className:"modal-overlay",children:t.jsxs("div",{className:"modal-content",children:[t.jsx("h2",{children:h==="add"?"Add Review":"Edit Review"}),t.jsxs("form",{onSubmit:je,children:[["name","company","review"].map(e=>t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-gray-700 mb-1",children:e.toUpperCase()}),e==="review"?t.jsx("textarea",{className:"form-input w-full",rows:"4",value:o[e],onChange:a=>j({...o,[e]:a.target.value}),required:!0}):t.jsx("input",{type:"text",className:"form-input w-full",value:o[e],onChange:a=>j({...o,[e]:a.target.value}),required:!0})]},e)),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-gray-700 mb-1",children:"Rating"}),t.jsx("select",{className:"form-select w-full",value:o.rating,onChange:e=>j({...o,rating:parseInt(e.target.value)}),children:[1,2,3,4,5].map(e=>t.jsx("option",{value:e,children:e},e))})]}),t.jsxs("div",{className:"flex justify-end",children:[t.jsx("button",{type:"button",onClick:()=>I(!1),className:"form-button bg-gray-400 mr-2",children:"Cancel"}),t.jsx("button",{type:"submit",className:"form-button bg-blue-600",children:h==="add"?"Add":"Save"})]})]})]})})]})};export{qe as default};
